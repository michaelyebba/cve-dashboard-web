import React, {Component} from 'react';
import Header from '../header/Header';
import Footer from '../footer/Footer';
import Datagrid from '../datagrid/Datagrid';
import axios from 'axios';

class DashboardPage extends Component {

    api = "https://cve-dashboard-service.herokuapp.com/api/";

    constructor (props) {
        super(props);
        this.state = {
            cves: [],
            isLoading: true    
        }
    }

    /**
     * Make ajax call to the cve dashboard service here
     */
    componentDidMount () {
        this.fetchData();
    }

    /**
     * Check if user changed the severity and re-fetch the data if they did
     * @param {*} prevProps 
     */
    componentDidUpdate(prevProps) {
        if(prevProps.severity !== this.props.severity) {
            this.setState({
                isLoading: true
            })
            this.fetchData();
        }
    }

    fetchData() {
        let url = this.api + "cves";
        if (this.props.severity) {
            url = this.api + "cves?severity=" + this.props.severity;
        }

        axios.get(url).then ((response) => {
                this.setState({
                    cves: response.data,
                    isLoading: false
                })
            }
        );
    }

    render () {
        
        const loadingStyles = {
            "maxWidth": "1000px",
            "margin": "auto",
            "padding": "20px 20px"
        };

        return (

            <div>
                <Header />

                {this.state.isLoading?
                    <p style={loadingStyles}>Loading, please wait...</p> :

                    <Datagrid title={this.props.title} cves={this.state.cves}/>
                } 
                <Footer />
            </div>
        )
    }
} 

DashboardPage.defaultProps = {
    title: "ALL"
}

export default DashboardPage;